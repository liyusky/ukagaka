<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="./css/rank.css">
  <link rel="stylesheet" href="./css/reset.css">
  <link rel="stylesheet" href="./css/animate.css">
  <link rel="stylesheet" href="./css/components.css">
  <link rel="stylesheet" href="./css/transaction.css">
  <script src="./scripts/echarts.min.js"></script>
  <script src="./scripts/china.js"></script>
  <script src="./scripts/geography.js"></script>
  <script src="./scripts/points.js"></script>
  <script src="./scripts/provices.js"></script>
  <script src="./scripts/customers.js"></script>
  <script src="./scripts/customer-index.js"></script>
  <script src="./scripts/jquery-3.3.1.min.js"></script>
  <script src="./scripts/ChinaMap.class.js"></script>
  <script src="./scripts/Transaction.class.js"></script>
</head>

<body>
  <section class="transaction">
    <header class="transaction-header">
      <div>城市</div>
      <div>姓名</div>
      <div>交易金额(元)</div>
      <div>时间</div>
    </header>
    <div class="transaction-wrap">
      <ul class="wrap-content" id="transaction-content"></ul>
    </div>
  </section>
  <section class="china-map">
    <div class="map" id="map"></div>
    <div class="tips" id="tips"></div>
  </section>
  <section class="rank">
    <header class="rank-header">
      <p>交易用户省份TOP10</p>
      <img class="header-arrow" src="./images/arrow.png">
    </header>
    <ul class="rank-list" id="rank">
      <li class="list-item hide">
        <div class="item-sequence">
          <img class="sequence-sign" src="./images/top-1.png">
        </div>
        <div class="item-name"></div>
        <div class="item-link">
          <div class="link-rail"></div>
        </div>
        <div class="item-num"></div>
      </li>
      <li class="list-item hide">
        <div class="item-sequence">
          <img class="sequence-sign" src="./images/top-2.png">
        </div>
        <div class="item-name"></div>
        <div class="item-link">
          <div class="link-rail"></div>
        </div>
        <div class="item-num"></div>
      </li>
      <li class="list-item hide">
        <div class="item-sequence">
          <img class="sequence-sign" src="./images/top-3.png">
        </div>
        <div class="item-name"></div>
        <div class="item-link">
          <div class="link-rail"></div>
        </div>
        <div class="item-num"></div>
      </li>
      <li class="list-item hide">
        <div class="item-sequence">4</div>
        <div class="item-name"></div>
        <div class="item-link">
          <div class="link-rail"></div>
        </div>
        <div class="item-num"></div>
      </li>
      <li class="list-item hide">
        <div class="item-sequence">5</div>
        <div class="item-name"></div>
        <div class="item-link">
          <div class="link-rail"></div>
        </div>
        <div class="item-num"></div>
      </li>
      <li class="list-item hide">
        <div class="item-sequence">6</div>
        <div class="item-name"></div>
        <div class="item-link">
          <div class="link-rail"></div>
        </div>
        <div class="item-num"></div>
      </li>
      <li class="list-item hide">
        <div class="item-sequence">7</div>
        <div class="item-name"></div>
        <div class="item-link">
          <div class="link-rail"></div>
        </div>
        <div class="item-num"></div>
      </li>
      <li class="list-item hide">
        <div class="item-sequence">8</div>
        <div class="item-name"></div>
        <div class="item-link">
          <div class="link-rail"></div>
        </div>
        <div class="item-num"></div>
      </li>
      <li class="list-item hide">
        <div class="item-sequence">9</div>
        <div class="item-name"></div>
        <div class="item-link">
          <div class="link-rail"></div>
        </div>
        <div class="item-num"></div>
      </li>
      <li class="list-item hide">
        <div class="item-sequence">10</div>
        <div class="item-name"></div>
        <div class="item-link">
          <div class="link-rail"></div>
        </div>
        <div class="item-num"></div>
      </li>
    </ul>
  </section>
  <script>
    const ws = new WebSocket("ws://192.168.0.101:8080");
    switch (ws.readyState) {
      case WebSocket.CLOSING:
        location.reload();
        break;
      case WebSocket.CLOSED:
        refresh();
        break;
    }
  </script>
  <script>
    window.onload = function () {
      const chinaMap = new ChinaMap();
      const transaction = new Transaction();
      ws.addEventListener('message', message => {
        try {
          chinaMap.mount(message);
        } catch (error) {
          refresh();
        }
      })
      ws.addEventListener('message', message => {
        try {
          transaction.mount(message);
        } catch (error) {
          refresh();
        }
      });
    }

    function refresh() {
      setTimeout(() => {
        location.reload();
      }, 5000);
    }
  </script>
</body>

</html>